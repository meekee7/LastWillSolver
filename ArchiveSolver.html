
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Last Will Archive Puzzle Solver</title>

<!-- Bootstrap -->
<link href="css/bootstrap.css" rel="stylesheet">

<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<a href="https://github.com/meekee7/beetlepuzzlesolver/tree/gh-pages"><img style="position: absolute; top: 0; left: 0; border: 0;" src="https://camo.githubusercontent.com/82b228a3648bf44fc1163ef44c62fcc60081495e/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f6c6566745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_left_red_aa0000.png"></a>
<div class="wrapper container-fluid">
  <div class="row">
    <div class="col-md-6 text-center col-lg-offset-4 col-lg-4">
        <h1 class="text-center" href="index.html"><a href="index.html"> Last Will - Puzzle Solvers </a></h1>
        <h2>Archives</h2>
    </div>
  </div>
  <hr>
</div>
<div class="container">
  <div class="row text-center">
    <div class="col-md-6 col-md-offset-3 col-lg-offset-0 col-lg-12"><strong> Instructions </strong> <br>
      Enter the nine letters below. <br>
      Make sure that the middle letter (marked with the keyhole) is also the middle letter below. <br>
      Click the 'Solve' button. <br>
      Enter words in the game until you can fetch the key. Longer words make it rise faster.<br> <br>
      
      Each acceptable word needs to contain the letter in the middle and a vowel. The letter Y is not seen as a vowel by the game. <br>
      <a href="https://github.com/first20hours/google-10000-english/blob/master/20k.txt">Source of the word list</a>
      </div><br>
      <strong><font color="red"><noscript>JavaScript is required to run this solver. In your browser JavaScript is disabled or unsupported. Please enable JavaScript or try a different browser.</noscript></font></strong>
  </div>
  <hr>
  <div class="row">
    <div class="text-center col-sm-2 col-sm-offset-5 table-bordered">
      <label for="allletters"><strong>All letters</strong></label>
      <div class="row">
          <div class="input-group">
            <input type="text" id="allletters" style="text-align:center" class="form-control" aria-describedby="addon1" autocorrect="off" autocapitalize="off" autocomplete="off" onInput="allletterinput()">
          </div>
          <strong>Layout</strong>
          <div class="row">
          <input id="lt1" style="text-align:center" type="text" size="1" disabled>
          <input id="lt2" style="text-align:center" type="text" size="1" disabled>
          <input id="lt3" style="text-align:center" type="text" size="1" disabled>
          </div>
          <div class="row">
          <input id="lt4" style="text-align:center" type="text" size="1" disabled>
          <input id="lt5" style="text-align:center" type="text" size="1" disabled>
          <input id="lt6" style="text-align:center" type="text" size="1" disabled>
          </div>
          <div class="row">
          <input id="lt7" style="text-align:center" type="text" size="1" disabled>
          <input id="lt8" style="text-align:center" type="text" size="1" disabled>
          <input id="lt9" style="text-align:center" type="text" size="1" disabled>
          </div>
      </div>
    </div>
  </div>
 
</div>
<hr>
<div class="row">
	<center>
    Solving can take a couple of seconds (especially on smartphones). Please be patient.
    </center>
  <div class="text-center col-md-6 col-md-offset-3">
    <button type="button" class="btn btn-lg btn-primary" onClick="solve()">Solve Puzzle</button>
  </div>
</div>
<script>
function allletterinput(){
	
	var elem = document.getElementById("allletters");
	var value = elem.value;
	/*
	if (value.length > 9)
		value = value.slice(0,9);
	value = value.toUpperCase();
	
	
	value.replace([0-9],"");
	elem.value = value;
	*/
	
	//if (value.length >= 5)
	//	document.getElementById("middleletter").value = value.slice(4,5);
		
	for (var i=0; i<9 && i<value.length; i++)
		document.getElementById("lt"+(i+1)).value = value.slice(i,i+1).toLowerCase();
	for (var i=value.length; i<9; i++)
		document.getElementById("lt"+(i+1)).value = "";
}

function lettercountmatch(a, b){
	for (var i=0; i<b.length; i++){
		var char = b[i];
		var bcount = 0;
		for (var j=0; j<b.length; j++)
			if (b[j] == char)
				bcount++;
		var acount = 0;
		for (var j=0; j<a.length; j++)
			if (a[j] == char)
				acount++;
		if (bcount > acount)
			return false;
	}
	return true;
}

function acceptable(letters, middle, word){
	var vowelregex = new RegExp(/[aeiou]/);
	var wordregex = new RegExp("^(?:([" + word + "])(?!.*?1)){1,9}$");
	return word.search(middle) != -1 && vowelregex.test(word) && wordregex.test(word) && lettercountmatch(letters, word);
}

function wordcomplength(a, b){
	return b.length - a.length;
}

function solve(){
	var input = document.getElementById("allletters");
	var text = input.value.toLowerCase();
	var middle = text.slice(4,5);
	var solnode = document.getElementById("solutiontxt");
	
	if (text.length != 9){
		solnode.innerHTML = "<font color=\"red\"> Error: Invalid input. The input has to contain nine letters.</font>";
		return;	
	}
	for (var i=0; i<text.length; i++)
		if (!text[i].match("[a-z]")){
			solnode.innerHTML = "<font color=\"red\"> Error: Invalid input. The input has to contain nine letters.</font>";
			return;
		}
	solnode.innerHTML = "Processing. Please wait...";
	var request = new XMLHttpRequest();
	request.onreadystatechange = function() {
		 if (this.readyState == 4)
		 	if (this.status == 200) {
            	var response = this.responseText;
				var wordlist = response.split("\n");
				var matches = [];
				for (var i=0; i<wordlist.length; i++)
					if (acceptable(text, middle, wordlist[i]))
						matches.push(wordlist[i]);
				matches.sort(wordcomplength);
				
				var resultstring = "Found " + matches.length + " matches:<br>";
				for (var i=0; i<matches.length; i++)
					resultstring += (i+1) + ". "+matches[i]+"<br>";
				solnode.innerHTML = resultstring;
				
        	} else 
				solnode.innerHTML = "<font color=\"red\"> Error: Could not load word list. Responde code: " + this.status + ".</font>"
	}
	if (document.URL.indexOf("file:///" != -1))
		request.open("GET", "https://meekee7.github.io/LastWillSolver/data/20k.txt", true); //For local testing
	else
		request.open("GET", "data/20k.txt", true);
	request.send();
}
</script>
<hr>
<div class="row">
  <div class="text-center col-md-6 col-md-offset-3" id="solutiontxt"> 
   </div>
</div>
<hr>
<div class="row">
  <div class="text-center col-md-6 col-md-offset-3">
    <h4><!--TODO FOOTER--></h4>
    <a href="http://mcro.org/morphopolis"> Morphopolis is a game by MCRO, released for various platforms. </a>
    <p>Copyright &copy; 2016 &middot; All Rights Reserved &middot;</p>
  </div>
</div>
<hr>
<!--</div>-->
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) --> 
<script src="js/jquery-1.11.3.min.js"></script> 

<!-- Include all compiled plugins (below), or include individual files as needed --> 
<script src="js/bootstrap.js"></script>
</body>
</html>
