<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Last Will Transfer Chamber Puzzle Solver</title>

<!-- Bootstrap -->
<link href="css/bootstrap.css" rel="stylesheet">

<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<a href="https://github.com/meekee7/LastWillSolver/tree/gh-pages"><img style="position: absolute; top: 0; left: 0; border: 0;" src="https://camo.githubusercontent.com/82b228a3648bf44fc1163ef44c62fcc60081495e/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f6c6566745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_left_red_aa0000.png"></a>
<div class="wrapper container-fluid">
  <div class="row">
    <div class="col-md-6 text-center col-lg-offset-4 col-lg-4">
      <h1 class="text-center" href="index.html"><a href="index.html"> Last Will - Puzzle Solvers </a></h1>
      <h2>Final Puzzle</h2>
    </div>
  </div>
  <hr>
</div>
<div class="container">
  <div class="row text-center">
    <div class="col-md-6 col-md-offset-3 col-lg-offset-0 col-lg-12"><strong> Instructions </strong> <br>
      Find the clue sheet and enter the numbers below. <br>
      Open each fuse box and enter the number written inside the door below. <br>
      Flip the switches according to the solution.<br>
      <br>
      Puzzle rules:<br>
      There are three power lines: top, middle and bottom. Each line carries an amount of power as described by the clue sheet.<br>
      Each fuse box has one fuse for each line, so each line also has three fuses. The line's power is shared equally between the fuses on it that are switched on.<br>
      For each fuse box the sum of power shares of its fuses has to be equal to the number on the box. In that case the indicator of the box turns green.<br>
      <br>
      The puzzle is solved when all three boxes show green indicators.<br>
      To solve the <i>room</i>, you must solve the puzzle and then either use the elevator or step into the machine and pull a lever. </div>
    <br>
    <strong><font color="red">
    <noscript>
    JavaScript is required to run this solver. In your browser JavaScript is disabled or unsupported. Please enable JavaScript or try a different browser.
    </noscript>
    </font></strong> </div>
  <hr>
  <div class="row text-center col-sm-6 col-sm-offset-3 table-bordered">
    <div class="col-sm-4">
      <label for="sheet1">Sheet 1</label>
      <input id="sheet1" style="text-align:center" type="number" size="2">
      <label for="box1">Box 1</label>
      <input id="box1" style="text-align:center" type="number" size="2">
    </div>
    <div class="col-sm-4">
      <label for="sheet2">Sheet 2</label>
      <input id="sheet2" style="text-align:center" type="number" size="2">
      <label for="box2">Box 2</label>
      <input id="box2" style="text-align:center" type="number" size="2">
    </div>
    <div class="col-sm-4">
      <label for="sheet3">Sheet 3</label>
      <input id="sheet3" style="text-align:center" type="number" size="2">
      <label for="box3">Box 3</label>
      <input id="box3" style="text-align:center" type="number" size="2">
    </div>
  </div>
</div>
<hr>
<div class="row">
  <center>
    Solving can take a couple of seconds (especially on smartphones). Please be patient.
  </center>
  <div class="text-center col-md-6 col-md-offset-3">
    <button type="button" class="btn btn-lg btn-primary" onClick="solve()">Solve Puzzle</button>
  </div>
</div>
<script src="js/hashtable.js"></script> 
<script src="js/hashset.js"></script> 
<script>
function Solution(code, csums, rsums){
	this.cols = [[
		Boolean(code & (1 << 0)),
		Boolean(code & (1 << 1)),
		Boolean(code & (1 << 2)),
		],[
		Boolean(code & (1 << 3)),
		Boolean(code & (1 << 4)),
		Boolean(code & (1 << 5)),
		],[
		Boolean(code & (1 << 6)),
		Boolean(code & (1 << 7)),
		Boolean(code & (1 << 8)),
		]];
	this.csums = csums;
	this.rsums = rsums;
	
	this.rsplits = [
		Math.floor(this.rsums[0]/this.countRow(0)),
		Math.floor(this.rsums[1]/this.countRow(1)),
		Math.floor(this.rsums[2]/this.countRow(2))
		];
}
	
Solution.prototype.countRow = function(row){
	return this.cols[0][row] + this.cols[1][row] + this.cols[2][row];
}

Solution.prototype.sumCol = function(col){
	var sum = 0;
	for (var i=0; i<3; i++)
		sum += this.cols[col][i] * this.rsplits[i];
	return sum;
}

Solution.prototype.isCorrect = function(){
	for (var i=0; i<3; i++)
		if (this.sumCol(i) != this.csums[i])
			return false;
	return true;
}

function solve(){
	var sheetinput = ["sheet1", "sheet2", "sheet3"];
	var boxinput = ["box1", "box2", "box3"];
	var sheetnum = [0,0,0];
	var boxnum = [0,0,0];
	for (var i=0; i<sheetinput.length; i++){
		var input = document.getElementById(sheetinput[i]);
		var text = input.value;
		sheetnum[i] = parseInt(text);		
	}
	for (var i=0; i<boxnum.length; i++){
		var input = document.getElementById(boxinput[i]);
		var text = input.value;
		boxnum[i] = parseInt(text);		
	}
	var solnode = document.getElementById("solutiontxt");
	
	var solution = null;
	for (var i=0; i< (1 << 9); i++) {//512
		var candidate = new Solution(i, boxnum, sheetnum);
		if (solution != null && candidate.isCorrect())
			console.log("double solution");
		if (candidate.isCorrect())
			solution = candidate;
		if (solution != null)
			break;
	}
	var solcellnames = [["sl1", "sl4", "sl7"], ["sl2", "sl5", "sl8"],["sl3", "sl6", "sl9"]];
	if (solution == null){
		solnode.innerHTML = "NO SOLUTION FOUND";
		for (var i=0; i<3; i++)
			for (var j=0; j<3; j++)
				document.getElementById(solcellnames[i][j]).value = "";
	} else {
		solnode.innerHTML = "Solution found:";
		var solcellnames = [["sl1", "sl4", "sl7"], ["sl2", "sl5", "sl8"],["sl3", "sl6", "sl9"]];
		for (var i=0; i<3; i++)
			for (var j=0; j<3; j++)
				document.getElementById(solcellnames[i][j]).value = solution.cols[i][j] == true ? "up" : "down";
	}
}
</script>
<hr>
<div class="row">
  <div class="text-center col-md-6 col-md-offset-3" id="solutiontxt"> </div>
</div>
<div class="text-center col-sm-2 col-sm-offset-5 table-bordered">
  <div class="row">
    <div class="col-sm-4">Box 1
      <input id="sl1" style="text-align:center" type="text" size="4" disabled>
      <input id="sl4" style="text-align:center" type="text" size="4" disabled>
      <input id="sl7" style="text-align:center" type="text" size="4" disabled>
    </div>
    <div class="col-sm-4">Box 2
      <input id="sl2" style="text-align:center" type="text" size="4" disabled>
      <input id="sl5" style="text-align:center" type="text" size="4" disabled>
      <input id="sl8" style="text-align:center" type="text" size="4" disabled>
    </div>
    <div class="col-sm-4">Box 3
      <input id="sl3" style="text-align:center" type="text" size="4" disabled>
      <input id="sl6" style="text-align:center" type="text" size="4" disabled>
      <input id="sl9" style="text-align:center" type="text" size="4" disabled>
    </div>
  </div>
</div>
<hr>
<div class="row">
  <div class="text-center col-md-6 col-md-offset-3">
    <h4><!--TODO FOOTER--></h4>
    <a href="http://lastwill.gg/"> Last Will is a game by Lizard Factory </a>
    <p>Copyright &copy; 2016 &middot; All Rights Reserved &middot;</p>
  </div>
</div>
<hr>
<!--</div>--> 
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) --> 
<script src="js/jquery-1.11.3.min.js"></script> 

<!-- Include all compiled plugins (below), or include individual files as needed --> 
<script src="js/bootstrap.js"></script>
</body>
</html>
